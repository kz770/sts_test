<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
	.page{
		margin-right:10px;
		cursor:pointer;
	}
</style>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript">
	$(function() {
		
/* 		setInterval(function(){
			$.ajax({
				url:"/seat",
				success:function(data){	// data : controller에서 return하는 값
					$("#seat").html(data);
				}
			})
		},3000) */
		
		
		//전체 레코드를 담기 위한 배열명
		let arr;
		let pageSIZE=10;	//한 화면에 보여줄 레코드의 수
		let pageGROUP=10;		//한 화면에 보여줄 페이지의 수
		let totalRecord;	//전체 레코드 수를 담기 위한 변수
		let totalPage;		//전체 페이지 수를 담기 위한 변수
		
		
		//미래에 만들어진 .page에 이벤트 연결하기
		$("#paging").on("click",".page",function(){
			var pageNUM=eval($(this).attr("pageNUM"));
			loadData(pageNUM);
		})
		

		function loadData(pageNUM){
			$("#list").empty();
			
			let start=(pageNUM-1)*pageSIZE;
			let end=start+pageSIZE;
			if(end>totalPage-1){
				end=totalPage-1;
			}
			console.log(start, end);
			for(i=start;i<=end;i++){
				let book=arr[i];
				var bookList=$('#list');
				var bookItem=$('<li></li>');
				var bookLink=$('<a></a>').html(book.title).attr('href',book.link);
				bookItem.append(bookLink);
				bookList.append(bookItem);	
			}
			
			printPage(pageNUM);
		}
		
		//페이지 번호 출력
		function printPage(pageNUM){
			$("#paging").empty();
			var startPage=parseInt((pageNUM-1)/pageGROUP)*pageGROUP+1;
			var endPage=startPage+pageGROUP-1;
			
			console.log(startPage);
			console.log(endPage);
			
			if(startPage>1){
				let span=$("<span></span>").html("[prev]").addClass("page").attr("pageNUM",startPage-1);
				$("#paging").append(span);
			}
			
			// 현재 페이지에 따라서 start페이지와 end페이지까지 총 10개씩 보여준다
			for(let i=startPage;i<=endPage;i++){
				var span=$("<span></span>").html(i).addClass("page").attr("pageNUM",i);
				$("#paging").append(span);
			}
			
			if(endPage<totalPage){
				let span=$("<span></span>").html("[next]").addClass("page").attr("pageNUM", endPage+1);
				$("#paging").append(span);
			}
		}
		
		 $.ajax({
			url : "/newBook",
			success : function(r) {
				arr=r;
				console.log(arr);
				totalRecord=arr.length;
				console.log(totalRecord);
				totalPage=Math.ceil(totalRecord/pageSIZE);
				console.log(totalPage);
				loadData(1);
			}
		}) 

	})
</script>
</head>
<body>
	마포평생학습관 빈 자리수 : <div id="seat"></div>
	<h2>새로운 도서 정보</h2>
	<hr>
	<ul id="list"></ul>
	<div id="paging">
	</div>
</body>
</html>