<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript">
	$(function() {
		// 세션 스토리지에 저장된 정렬기준과 키워드를 가져와서 값 설정
		console.log(sessionStorage.getItem("keyword"));
		let currentColumn = sessionStorage.getItem('searchColumn');

		if (currentColumn != null) {

			$("#searchColumn").val(currentColumn);
			$("input[name='keyword']").val(sessionStorage.getItem('keyword'));

			// 검색한 컬럼이 price이면 op를 보이도록 한다
			if (currentColumn == 'Price') {
				$("select[name='op']").css("display", "inline-block");
				$("select[name='op']").val(sessionStorage.getItem("op"));
				console.log(sessionStorage.getItem("op"));
			}
		}

		$("#searchForm").submit(function() {
			let searchColumn = $("#searchColumn").val();
			sessionStorage.setItem("searchColumn", searchColumn);
			let keyword = $("input[name='keyword']").val();
			sessionStorage.setItem("keyword", keyword);
			if (searchColumn == 'Price') {
				let op = $("select[name='op']").val();
				sessionStorage.setItem("op", op);
			}
		})

		console.log(searchColumn)
		$("#searchColumn").change(function() {
			$("input[name='keyword']").val("");
			let searhColumn = $(this).val();
			if (searhColumn == "Price") {
				$("#op").css("display", "inline-block");
			} else {
				$("#op").css("display", "none");

			}
		})
	})
</script>
<style type="text/css">
#op {
	display: none;
}
</style>
</head>
<body>
	<div class="container mt-3">
		<div
			style="display: flex; align-items: center; justify-content: space-between;">
			<h2>Book List</h2>
			<form action="/book/list" method="get" id="searchForm">
				<select id="searchColumn" name="searchColumn">
					<option value="Bookname">book name</option>
					<option value="Price">price</option>
					<option value="Bookid">bookid</option>
					<option value="Publisher">publisher</option>
				</select> <select name="op" id="op">
					<option value="">=</option>
					<option value="GreaterThan">></option>
					<option value="LessThan"><</option>
					<option value="GreaterThanEqual">>=</option>
					<option value="LessThanEqual"><=</option>
				</select> <input type="search" name="keyword"> <input type="submit"
					value="search">
			</form>
		</div>
		<hr>

		<table border="1" width="70%" class="table table-hover">
			<tr>
				<th><a href="/book/list?sname=Bookid">Book ID</a></th>
				<th><a href="/book/list?sname=Bookname">Book Name</a></th>
				<th><a href="/book/list?sname=Price">Price</a></th>
				<th><a href="/book/list?sname=Publisher">Publisher</a></th>
			</tr>
			<tr th:each="book:${list}">
				<td th:text="${book.bookid}"></td>
				<td><a th:href="@{/book/detail(bookid=${book.bookid})}"> <span
						th:text="${book.bookname}"></span>
				</a></td>
				<td th:text="${book.price}"></td>
				<td th:text="${book.publisher}"></td>
			</tr>
		</table>
		<br>
		<button type="button" class="btn btn-primary btn-block"
			onclick="location.href='/book/insert.html'">New Book</button>
		<button type="button" class="btn btn-light btn-block"
			onclick="location.href='/'">Back to Index</button>
		<br>
	</div>
</body>